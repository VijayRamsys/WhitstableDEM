{"paragraphs":[{"text":"%pyspark\nfrom __future__ import print_function\n\nfrom pyspark.sql import SparkSession\n\nfrom pyspark.sql import Row\n\nfrom pyspark.sql.types import *\n\nimport matplotlib.pyplot as plt\n\nimport pandas as pd  \n\nimport numpy as np\n\nimport pylab as P\n\n\n\nincidentDAT = sc.textFile(\"/home/ramsys/Dev/whitstable/data/incident.txt\")\nincidentRDD = incidentDAT.map(lambda x: x.split(\"\\t\")).map(lambda x: Row(float(x[0]), x[1], x[2], x[3], x[4], x[5], x[6] ))\nincidentDFrame = incidentRDD.toDF([\"gross_ton\",\"vlength\",\"vdepth\",\"vessel_class\",\"vessel_age\",\"route_type\",\"Accident\"])\nincidentDFrame.printSchema()\nincidentDFrame.show()\n\n\n","dateUpdated":"2017-02-10T09:18:38+0530","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1486005413601_-109394638","id":"20170202-084653_305629268","result":{"code":"SUCCESS","type":"TEXT","msg":"root\n |-- gross_ton: double (nullable = true)\n |-- vlength: string (nullable = true)\n |-- vdepth: string (nullable = true)\n |-- vessel_class: string (nullable = true)\n |-- vessel_age: string (nullable = true)\n |-- route_type: string (nullable = true)\n |-- Accident: string (nullable = true)\n\n+---------+-------+------+--------------------+----------+--------------------+--------+\n|gross_ton|vlength|vdepth|        vessel_class|vessel_age|          route_type|Accident|\n+---------+-------+------+--------------------+----------+--------------------+--------+\n|    159.0|   89.3|  12.0|        Recreational|      70.0|         UNSPECIFIED|     Yes|\n|      0.0|  250.0|  10.5|               Barge|      65.0|         UNSPECIFIED|     Yes|\n|   9876.0|  459.8|  36.2|               Barge|      22.0|              Oceans|     Yes|\n|   1830.0|  284.0|  11.2|               Barge|      53.0|\"Lakes, Bays, and...|     Yes|\n|   1983.0|  209.5|  12.5|            Offshore|      35.0|         UNSPECIFIED|     Yes|\n|      9.0|   37.0|   3.2|      Fishing Vessel|      30.0|         UNSPECIFIED|     Yes|\n|     94.0|   77.7|  11.3|       Towing Vessel|      61.0|         UNSPECIFIED|     Yes|\n|   6577.0|  424.5|  32.8|General Dry Cargo...|          |         UNSPECIFIED|     Yes|\n|    127.0|   65.0|   9.0|       Towing Vessel|      17.0|         UNSPECIFIED|     Yes|\n|     73.0|   95.8|  10.1|       Towing Vessel|      32.0|         UNSPECIFIED|     Yes|\n|      0.0|    0.0|   0.0|      Fishing Vessel|          |              Oceans|     Yes|\n|     42.0|   64.0|   5.0|      Passenger Ship|       9.0|              Oceans|     Yes|\n|    114.0|   71.0|  10.0|       Towing Vessel|      24.0|         UNSPECIFIED|     Yes|\n|      0.0|   20.0|   0.0|        Recreational|      40.0|         UNSPECIFIED|     Yes|\n|  55936.0|  845.8|  60.7|        Bulk Carrier|      33.0|              Oceans|     Yes|\n|     93.0|  102.6|   6.8|            Offshore|      35.0|              Oceans|     Yes|\n|  23790.0|  574.8|  53.1|General Dry Cargo...|      31.0|              Oceans|     Yes|\n|  36627.0|  792.3|  62.3|General Dry Cargo...|      24.0|              Oceans|     Yes|\n|  27986.0|  623.0|  55.5|        Bulk Carrier|      13.0|              Oceans|     Yes|\n|     58.0|   70.7|   7.2|      Passenger Ship|      43.0|\"Lakes, Bays, and...|     Yes|\n+---------+-------+------+--------------------+----------+--------------------+--------+\nonly showing top 20 rows\n\n"},"dateCreated":"2017-02-02T08:46:53+0530","dateStarted":"2017-02-10T09:18:38+0530","dateFinished":"2017-02-10T09:18:52+0530","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:98"},{"text":"%pyspark\nincidentDFrame.createOrReplaceTempView(\"vessel\")\nVesselClassDF = spark.sql(\"SELECT vessel_class, count(vessel_class) as vessel_classcount FROM vessel GROUP BY vessel_class ORDER BY vessel_classcount\")\nVesselClassDF.show()","dateUpdated":"2017-02-10T09:18:38+0530","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1486036235177_1578257118","id":"20170202-172035_1177299881","result":{"code":"SUCCESS","type":"TEXT","msg":"+--------------------+-----------------+\n|        vessel_class|vessel_classcount|\n+--------------------+-----------------+\n|         School Ship|              186|\n|             Warship|              344|\n|Refrigerated Carg...|              568|\n|       Research Ship|              978|\n|    Ro-Ro Cargo Ship|             1074|\n|            Offshore|             2186|\n|         UNSPECIFIED|             6255|\n|        Bulk Carrier|             7627|\n|Miscellaneous Vessel|             7739|\n|           Tank Ship|             8348|\n|               Barge|             8848|\n|       Towing Vessel|             9678|\n|General Dry Cargo...|            15316|\n|      Passenger Ship|            20887|\n|      Fishing Vessel|            44944|\n|        Recreational|           125386|\n+--------------------+-----------------+\n\n"},"dateCreated":"2017-02-02T05:20:35+0530","dateStarted":"2017-02-10T09:18:39+0530","dateFinished":"2017-02-10T09:18:59+0530","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:99"},{"text":"%pyspark\nimport matplotlib.pyplot as plt\nfrom pylab import show\n\nvessel_classTuple = VesselClassDF.rdd.map(lambda p: (p.vessel_class,p.vessel_classcount)).collect()\nvessel_classList, vessel_classcountList = zip(*vessel_classTuple)\nexplode = (0.1,0.2,0.4,0.6,0.8,0.9,0.2,0.4,0.6,0.8,0.6,0.4,0.2,0.1,0.1,0.2)  \nplt.pie(vessel_classcountList, explode=explode, labels=vessel_classList, autopct='%1.1f%%', shadow=True, startangle=45)\nplt.title('\\n')\nplt.show()","dateUpdated":"2017-02-10T09:18:39+0530","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1486036386580_-2001984639","id":"20170202-172306_2069057483","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"2017-02-02T05:23:06+0530","dateStarted":"2017-02-10T09:18:53+0530","dateFinished":"2017-02-10T09:19:17+0530","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:100"},{"text":"%sql\nSELECT vessel_class, count(vessel_class) as vessel_classcount FROM vessel\nGROUP BY vessel_class\nORDER BY vessel_classcount\n\n","dateUpdated":"2017-02-10T09:18:39+0530","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"vessel_class","index":0,"aggr":"sum"}],"values":[{"name":"vessel_classcount","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"vessel_class","index":0,"aggr":"sum"},"yAxis":{"name":"vessel_classcount","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1486036552366_1213006174","id":"20170202-172552_1691164069","result":{"code":"SUCCESS","type":"TABLE","msg":"vessel_class\tvessel_classcount\nSchool Ship\t186\nWarship\t344\nRefrigerated Cargo Ship\t568\nResearch Ship\t978\nRo-Ro Cargo Ship\t1074\nOffshore\t2186\nUNSPECIFIED\t6255\nBulk Carrier\t7627\nMiscellaneous Vessel\t7739\nTank Ship\t8348\nBarge\t8848\nTowing Vessel\t9678\nGeneral Dry Cargo Ship\t15316\nPassenger Ship\t20887\nFishing Vessel\t44944\nRecreational\t125386\n","comment":"","msgTable":[[{"key":"vessel_classcount","value":"School Ship"},{"key":"vessel_classcount","value":"186"}],[{"value":"Warship"},{"value":"344"}],[{"value":"Refrigerated Cargo Ship"},{"value":"568"}],[{"value":"Research Ship"},{"value":"978"}],[{"value":"Ro-Ro Cargo Ship"},{"value":"1074"}],[{"value":"Offshore"},{"value":"2186"}],[{"value":"UNSPECIFIED"},{"value":"6255"}],[{"value":"Bulk Carrier"},{"value":"7627"}],[{"value":"Miscellaneous Vessel"},{"value":"7739"}],[{"value":"Tank Ship"},{"value":"8348"}],[{"value":"Barge"},{"value":"8848"}],[{"value":"Towing Vessel"},{"value":"9678"}],[{"value":"General Dry Cargo Ship"},{"value":"15316"}],[{"value":"Passenger Ship"},{"value":"20887"}],[{"value":"Fishing Vessel"},{"value":"44944"}],[{"value":"Recreational"},{"value":"125386"}]],"columnNames":[{"name":"vessel_class","index":0,"aggr":"sum"},{"name":"vessel_classcount","index":1,"aggr":"sum"}],"rows":[["School Ship","186"],["Warship","344"],["Refrigerated Cargo Ship","568"],["Research Ship","978"],["Ro-Ro Cargo Ship","1074"],["Offshore","2186"],["UNSPECIFIED","6255"],["Bulk Carrier","7627"],["Miscellaneous Vessel","7739"],["Tank Ship","8348"],["Barge","8848"],["Towing Vessel","9678"],["General Dry Cargo Ship","15316"],["Passenger Ship","20887"],["Fishing Vessel","44944"],["Recreational","125386"]]},"dateCreated":"2017-02-02T05:25:52+0530","dateStarted":"2017-02-10T09:18:59+0530","dateFinished":"2017-02-10T09:19:08+0530","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:101"},{"text":"%pyspark\nvesselAccident = spark.sql(\"SELECT vessel_class, Accident FROM vessel\")\nvesselAccident.show()","dateUpdated":"2017-02-10T09:18:39+0530","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1486695552162_617342516","id":"20170210-082912_696199282","result":{"code":"SUCCESS","type":"TEXT","msg":"+--------------------+--------+\n|        vessel_class|Accident|\n+--------------------+--------+\n|        Recreational|     Yes|\n|               Barge|     Yes|\n|               Barge|     Yes|\n|               Barge|     Yes|\n|            Offshore|     Yes|\n|      Fishing Vessel|     Yes|\n|       Towing Vessel|     Yes|\n|General Dry Cargo...|     Yes|\n|       Towing Vessel|     Yes|\n|       Towing Vessel|     Yes|\n|      Fishing Vessel|     Yes|\n|      Passenger Ship|     Yes|\n|       Towing Vessel|     Yes|\n|        Recreational|     Yes|\n|        Bulk Carrier|     Yes|\n|            Offshore|     Yes|\n|General Dry Cargo...|     Yes|\n|General Dry Cargo...|     Yes|\n|        Bulk Carrier|     Yes|\n|      Passenger Ship|     Yes|\n+--------------------+--------+\nonly showing top 20 rows\n\n"},"dateCreated":"2017-02-10T08:29:12+0530","dateStarted":"2017-02-10T09:19:00+0530","dateFinished":"2017-02-10T09:19:18+0530","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:102"},{"text":"%pyspark\nvesselCrossTab = vesselAccident.stat.crosstab(\"vessel_class\", \"Accident\")\nvesselCrossTab.describe('No', 'Yes').show()\nvesselCrossTab.stat.cov('No', 'Yes')\nvesselCrossTab.stat.corr('No', 'Yes')","dateUpdated":"2017-02-10T09:18:39+0530","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1486697807146_-271731529","id":"20170210-090647_774449920","result":{"code":"SUCCESS","type":"TEXT","msg":"+-------+------------------+------------------+\n|summary|                No|               Yes|\n+-------+------------------+------------------+\n|  count|                16|                16|\n|   mean|        16030.5625|          242.1875|\n| stddev|31106.463542633173|306.66251129431083|\n|    min|               181|                 4|\n|    max|            125189|               915|\n+-------+------------------+------------------+\n\n0.23139994350989654\n"},"dateCreated":"2017-02-10T09:06:47+0530","dateStarted":"2017-02-10T09:19:17+0530","dateFinished":"2017-02-10T09:19:26+0530","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:103"},{"text":"%pyspark\nimport matplotlib.pyplot as plt\nfrom pylab import show\n\nvsaTuple = vesselCrossTab.rdd.map(lambda p: (p.vessel_class_Accident,p.No, p.Yes)).collect()\nvsaList, nList, yList = zip(*vsaTuple)\nN = len(vsaList)\nind = np.arange(N)    \nwidth = 0.75          \np1 = plt.bar(ind, nList, width, color='b')\np2 = plt.bar(ind, yList, width, color='r', bottom=nList)\nplt.ylabel('Count')\nplt.title('distribution of vessel class involved in accidents\\n')\nplt.xticks(ind + width/2., vsaList, rotation=90)\nplt.legend((p1[0], p2[0]), ('No', 'Yes'))\nplt.gcf().subplots_adjust(bottom=0.10)\nplt.show()","dateUpdated":"2017-02-10T09:22:30+0530","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1486697938085_-1430394358","id":"20170210-090858_1759076661","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"2017-02-10T09:08:58+0530","dateStarted":"2017-02-10T09:22:30+0530","dateFinished":"2017-02-10T09:22:37+0530","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:104","focus":true},{"text":"","dateUpdated":"2017-02-10T09:18:40+0530","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1486698173312_-2008551006","id":"20170210-091253_842094912","dateCreated":"2017-02-10T09:12:53+0530","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:105","dateFinished":"2017-02-10T09:19:26+0530","dateStarted":"2017-02-10T09:19:26+0530","result":{"code":"SUCCESS","type":"TEXT","msg":""}}],"name":"wsh_etl","id":"2C7MUCB82","angularObjects":{"2C5ZRPGUJ:shared_process":[],"2C9F69XSJ:shared_process":[],"2C67DU4G2:shared_process":[],"2C6D5EGMX:shared_process":[],"2C6VB6E6G:shared_process":[],"2C9S1VJ4U:shared_process":[],"2C9PZ5P6R:shared_process":[],"2C9P9C77E:shared_process":[],"2C8KC9DK7:shared_process":[],"2C71ANP3E:shared_process":[],"2C776UDWA:shared_process":[],"2C6XJ545Z:shared_process":[],"2C5XK7QJG:shared_process":[],"2C6MGE7HB:shared_process":[],"2C8FQ76T8:shared_process":[],"2C75CUAZ6:shared_process":[],"2C612P2FB:shared_process":[],"2C63PNDAA:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}